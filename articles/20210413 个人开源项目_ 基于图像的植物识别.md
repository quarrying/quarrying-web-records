#! https://zhuanlan.zhihu.com/p/364346303
# 个人开源项目: 基于图像的植物识别模型

植物鉴别一直是笔者想培养的业余爱好, 机器学习和计算机视觉又是笔者的专业领域, 又由于市面上的植物识别产品做批量化识别要收费; 各产品能识别的植物类别虽多, 但总有一些遗漏, 扩展性不可控. 于是萌生了自己做 **基于图像的植物识别** 项目的想法. 

## 项目概况
- 模型开源, 项目代码依赖少.
- 模型大小为 51.0M, Top1 准确率在 90% 以上.
- 支持的植物类别 (或者说分类单元, 其可能是属, 种, 亚种, 变种等) 会持续增加.
    - 20210413: 支持 1320 个植物分类单元.
    - 20210609: 支持 1630 个植物分类单元.
- 植物名称参考自权威的 [iPlant](http://www.iplant.cn/).

## 项目主页
<https://github.com/quarrying/quarrying-plant-id/>

欢迎 Star, PR 和 Fork.

## 效果展示

![Image](https://pic4.zhimg.com/80/v2-95e0c9fbea61bf0c78650a7128bc45a0.png)

![Image](https://pic4.zhimg.com/80/v2-679b2844c5b554ecf10be9713a1ef752.png)
## 一些细节

### 数据收集和整理

数据是深度学习的基石, 笔者花了大量的时间在数据收集和整理上.

数据的主要来源有: 百度图片, 必应图片, 新浪微博, 百度贴吧, 新浪博客和一些专业的植物网站等. 除了新浪微博, 其他都用了爬虫. 另外还有一些数据是笔者自己拍摄的.

爬虫爬取的图像的质量参差不齐, 标签可能有误, 且存在重复文件, 因此必须清洗. 笔者尝试的清洗方法包括自动化清洗, 半自动化清洗和手工清洗.

**自动化清洗**包括: 滤除小尺寸图像; 滤除宽高比很大或很小的图像; 滤除灰度图像; 根据图像感知哈希进行图像去重.

**半自动化清洗**包括: 利用预先训练的植物/非植物图像分类器对图像文件进行打分, 非植物图像应该有较低的得分; 利用前一阶段的植物分类器对图像文件 (每个文件都有一个预标类别) 进行预测, 取预标类别的概率值为得分, 不属于原预标类别的图像应该有较低的得分. 可以设置阈值, 滤除很低得分的文件; 另外利用得分对图像文件进行重命名, 并在资源管理器选择按文件名排序, 以便于后续手工清洗掉非植物图像和不是预标类别的图像.

**手工清洗**: 人工判断文件夹下图像是否属于文件夹名所标称的物种, 这需要相关的植物学专业知识, 是最耗时且枯燥的环节, 但也凭此认识了不少的植物.


### 数据现状

笔者把收集的数据集分为了正式集和候选集. 正式集每个分类单元的图像数基本上都在 100 张以上, 主要用来做训练. 候选集中的物种的图像比较少, 而且大部分对笔者来说是比较生疏的, 待图像量上来后会加入到正式集中. 

- 20210413: 正式集有 1320 个分类单元, 460352 张图像.
- 20210609: 正式集有 1630 个分类单元, 586557 张图像.


### 模型训练
骨干网络为 ResNet18, 结构略有调整, 损失函数为 softmax 交叉熵. 优化器为 SGD, 使用了 L2 正则化, 标签平滑正则化, 余弦退火学习率衰减策略和学习率预热. 这个方案比较保守, 待笔者有了更多更高的算力, 会尝试一些新的方案, 如细粒度图像检索 (FGIR), 度量学习, 自监督学习, 模型蒸馏等. 

当前的模型直接输出各类的置信度, 也可以将模型改造成特征提取器, 用自己的植物图像来构造底库, 这样可以用图像检索的方式来进行植物识别, 可扩展性更高.

- 20210413: 训练了 30 个 epoch, 在 GTX 1660 上大概用了 39 个小时, 在 23026 张图像的测试集上, Top1 准确率可以达到 94.0%.
- 20210609: 训练了 30 个 epoch, 在 GTX 1660 上大概用了两天多, 在 29313 张图像的测试集上, Top1 准确率可以达到 92.4%.


## **更新记录**
- 20210413, 发布
- 20210609, 更新

## **版权声明**
版权声明: 自由分享, 保持署名-非商业用途-非衍生, 知识共享3.0协议.  
如果你对本文有疑问或建议, 欢迎留言! 转载请保留版权声明!

